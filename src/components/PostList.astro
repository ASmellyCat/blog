---
interface Post {
  id: string;
  data: {
    title: string;
    date: Date;
    category: string;
    description?: string;
  };
}

interface Props {
  posts: Post[];
}

const { posts } = Astro.props;
const base = import.meta.env.BASE_URL;

const categoryLabels: Record<string, { cn: string; en: string }> = {
  stories: { cn: '故事', en: 'Stories' },
  feelings: { cn: '心情', en: 'Feelings' },
  essays: { cn: '随笔', en: 'Essays' },
  dreams: { cn: '梦境', en: 'Dreams' },
};

const sorted = posts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<ul class="space-y-0 divide-y divide-[var(--color-border)]">
  {sorted.map((post) => {
    const label = categoryLabels[post.data.category];
    return (
      <li>
        <a href={`${base}posts/${post.id}`} class="group block py-8 first:pt-0">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-xs uppercase tracking-widest text-[var(--color-accent)] font-medium">
              {label ? `${label.cn} / ${label.en}` : post.data.category}
            </span>
            <span class="text-[var(--color-border)]">&middot;</span>
            <time
              datetime={post.data.date.toISOString()}
              class="text-xs text-[var(--color-text-muted)] tracking-wide"
            >
              {post.data.date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </time>
          </div>
          <h3 class="font-serif text-2xl font-semibold leading-snug group-hover:text-[var(--color-accent)] transition-colors">
            {post.data.title}
          </h3>
          {post.data.description && (
            <p class="mt-3 text-[var(--color-text-muted)] leading-relaxed">
              {post.data.description}
            </p>
          )}
        </a>
      </li>
    );
  })}
</ul>
