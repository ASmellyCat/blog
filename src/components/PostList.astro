---
interface Post {
  id: string;
  data: {
    title: string;
    date: Date;
    category: string;
    description?: string;
  };
}

interface Props {
  posts: Post[];
  enTitles?: Record<string, string>;
}

const { posts, enTitles = {} } = Astro.props;
const base = import.meta.env.BASE_URL;

const categoryMeta: Record<string, { cn: string; en: string; neonClass: string; glowClass: string; boxGlowClass: string; borderColor: string }> = {
  stories: { cn: '故事', en: 'Stories', neonClass: 'neon-cyan', glowClass: 'glow-cyan', boxGlowClass: 'box-glow-cyan', borderColor: 'rgba(0, 240, 255, 0.2)', strokeColor: 'rgba(0, 240, 255, 0.6)', glowColor: 'rgba(0, 240, 255, 0.5)' },
  feelings: { cn: '心情', en: 'Feelings', neonClass: 'neon-pink', glowClass: 'glow-pink', boxGlowClass: 'box-glow-pink', borderColor: 'rgba(255, 45, 120, 0.2)', strokeColor: 'rgba(255, 45, 120, 0.6)', glowColor: 'rgba(255, 45, 120, 0.5)' },
  essays: { cn: '随笔', en: 'Essays', neonClass: 'neon-green', glowClass: 'glow-green', boxGlowClass: 'box-glow-green', borderColor: 'rgba(57, 255, 20, 0.2)', strokeColor: 'rgba(57, 255, 20, 0.6)', glowColor: 'rgba(57, 255, 20, 0.5)' },
  dreams: { cn: '梦境', en: 'Dreams', neonClass: 'neon-purple', glowClass: 'glow-purple', boxGlowClass: 'box-glow-purple', borderColor: 'rgba(191, 64, 255, 0.2)', strokeColor: 'rgba(191, 64, 255, 0.6)', glowColor: 'rgba(191, 64, 255, 0.5)' },
};

const sorted = posts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<div class="space-y-5">
  {sorted.map((post) => {
    const meta = categoryMeta[post.data.category];
    return (
      <a
        href={`${base}/posts/${post.id.replace(/\/(zh|en)$/, '')}`}
        class="post-card cyber-card block p-6 rounded-xl transition-all duration-300"
        data-glow-class={meta?.glowClass}
        data-box-glow-class={meta?.boxGlowClass}
        data-border-color={meta?.borderColor}
        style={`--card-glow-color: ${meta?.glowColor || "rgba(0,240,255,0.5)"};`}
      >
        <div class="flex items-center gap-3 mb-3">
          <span class:list={[
            "px-2.5 py-0.5 rounded-full text-[10px] tracking-[0.15em] uppercase font-medium border",
            meta?.neonClass || 'text-[var(--color-text-muted)]'
          ]}
          style={`border-color: ${meta?.borderColor || 'rgba(255,255,255,0.1)'}; background: transparent;`}
          >
            {meta ? `${meta.cn} / ${meta.en}` : post.data.category}
          </span>
          <time
            datetime={post.data.date.toISOString()}
            class="text-[11px] text-[var(--color-text-muted)] tracking-wider font-light"
            style="font-family: 'Orbitron', sans-serif;"
          >
            {post.data.date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
            })}
          </time>
        </div>
        <h3 class="post-title text-2xl leading-snug tracking-tight transition-all duration-300" style={`font-family: 'Orbitron', 'Noto Sans SC', sans-serif; font-weight: 800; color: #fff; -webkit-text-stroke: 1px ${meta?.strokeColor || 'rgba(255,255,255,0.3)'}; paint-order: stroke fill; text-shadow: none;`}>
          {enTitles[post.id.replace(/\/(zh|en)$/, "")] ? `${post.data.title} | ${enTitles[post.id.replace(/\/(zh|en)$/, "")]}` : post.data.title}
        </h3>
        {post.data.description && (
          <p class="mt-3 text-[var(--color-text-muted)] leading-relaxed font-light text-sm">
            {post.data.description}
          </p>
        )}
      </a>
    );
  })}
</div>

<script>
  document.querySelectorAll('.post-card').forEach((card) => {
    const el = card as HTMLElement;
    const glowClass = el.dataset.glowClass;
    const boxGlowClass = el.dataset.boxGlowClass;
    const borderColor = el.dataset.borderColor;
    const title = el.querySelector('.post-title');

    el.addEventListener('mouseenter', () => {
      if (glowClass && title) title.classList.add(glowClass);
      if (boxGlowClass) el.classList.add(boxGlowClass);
      if (borderColor) el.style.borderColor = borderColor;
    });
    el.addEventListener('mouseleave', () => {
      if (glowClass && title) title.classList.remove(glowClass);
      if (boxGlowClass) el.classList.remove(boxGlowClass);
      if (borderColor) el.style.borderColor = '';
    });
  });
</script>
